<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Firebase Authentication</title>
  <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>

  <script src="https://unpkg.com/vue"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
<div id="app">
    {{ info }}
    <h1>Vue School - Firebase Authentication</h1>
    <div v-if="authUser">
        <h2> Signed in as {{authUser.email}}</h2>
        <img :src="authUser.photoURL" height="150">
        <p>What's up, {{authUser.displayName || 'Friend' }}? </p>
        <button @click="signOut">Sign Out</button>
    </div>
    <div v-else>
        <form @submit.prevent="register">
            <h2>Register</h2>
            <input type="email" v-model="email" placeholder="Type your email">
            <input type="password" v-model="password" placeholder="Pick your password">
            <button>Register</button>
        </form>
        <form @submit.prevent="signIn">
            <h2>Sign In</h2>
            <input type="email" v-model="email" placeholder="Type your email">
            <input type="password" v-model="password" placeholder="Type your password">
            <button>Sign In</button>
        </form>
        <div>
            <h2>Sign In With Google</h2>
            <button @click="signInWithGoogle">Sign In</button>
        </div>
        <div>
            <h2>Sign In With Facebook</h2>
            <button @click="signInWithFacebook">Sign In</button>
        </div>
        <div>
            <h2>Sign In With Github</h2>
            <button @click="signInWithGithub">Sign In</button>
        </div>
        <div>
            <h2>Sign In With Twitter</h2>
            <button @click="signInWithTwitter">Sign In</button>
        </div>
    </div>
</div>
<script>
  var firebaseConfig = {
    apiKey: "AIzaSyDtcTSPOP5yUb9ZlNGgb1krROyLlAYXaeg",
    authDomain: "connectome-vn.firebaseapp.com",
    databaseURL: "https://connectome-vn.firebaseio.com",
    projectId: "connectome-vn",
    storageBucket: "",
    messagingSenderId: "1062366039219",
    appId: "1:1062366039219:web:47535f81732f7557"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  new Vue({
      el: '#app',

      data: {
          email: '',
          password: '',
          authUser: null,
          info: null
      },

      methods: {
          register() {
              firebase.auth().createUserWithEmailAndPassword(
                  this.email, this.password
              ).catch(error => console.log('ðŸ¤•' + error.message)).then( function (data) {
                  firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
                      // Send token to your backend via HTTPS
                      // ...
                      /*const formData = new FormData();
                      formData.append('access_token', idToken);
                      axios.post('http://localhost:5000/user/v1/google', formData).then( response => {
                          console.log(response)
                      }).catch(error => {
                          console.log('ðŸ¤•' + error.message)
                      })*/
                  }).catch( function(error) {
                      // Handle error
                      console.log(error.message)
                  });
              })
          },
          signOut() {
              firebase.auth().signOut()
          },
          signIn() {
              firebase.auth().signInWithEmailAndPassword(this.email,
                    this.password
                ).catch(error => console.log('ðŸ¤•' + error.message)).then( function (data) {
                  firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
                      // Send token to your backend via HTTPS
                      // ...
                      /*const formData = new FormData();
                      formData.append('access_token', idToken);
                      axios.post('http://localhost:5000/user/v1/register', formData).then( response => {
                          console.log(response)
                      }).catch(error => {
                          console.log('ðŸ¤•' + error.message)
                      })*/
                  }).catch( function(error) {
                      // Handle error
                      console.log(error.message)
                  });
              })
          },
          signInWithGoogle() {
              const provider = new firebase.auth.GoogleAuthProvider()
              provider.addScope('profile');
              provider.addScope('email');
              firebase.auth().signInWithPopup(provider)
              .catch(error => console.log('ðŸ¤•' + error.message))
              .then(function (data) {
                  firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
                      // Send token to your backend via HTTPS
                      // ...
                      /*const formData = new FormData();
                      formData.append('access_token', idToken);
                      axios.post('http://localhost:5000/user/v1/google', formData).then( response => {
                          console.log(response)
                      }).catch(error => {
                          console.log('ðŸ¤•' + error.message)
                      })*/
                  }).catch( function(error) {
                      // Handle error
                      console.log(error.message)
                  });
              })
          },
          signInWithFacebook() {
              const provider = new firebase.auth.FacebookAuthProvider()
              provider.addScope('profile');
              provider.addScope('email');
              firebase.auth().signInWithPopup(provider)
                  .catch(error => console.log('ðŸ¤•' + error.message))
                  .then( function (data)  {
                      firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
                          // Send token to your backend via HTTPS
                          // ...
                          /*const formData = new FormData();
                          formData.append('access_token', idToken);
                          axios.post('http://localhost:5000/user/v1/facebook', formData).then( response => {
                              console.log(response)
                          }).catch(error => {
                              console.log('ðŸ¤•' + error.message)
                          })*/
                      }).catch( function(error) {
                          // Handle error
                          console.log(error.message)
                      });
                  })
          },

          signInWithGithub() {
              const provider = new firebase.auth.GithubAuthProvider()
              provider.addScope('profile');
              provider.addScope('email');
              firebase.auth().signInWithPopup(provider)
                  .catch(error => console.log('ðŸ¤•' + error.message))
                  .then(function (data) {
                      firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
                          // Send token to your backend via HTTPS
                          // ...
                          /*const formData = new FormData();
                          formData.append('access_token', idToken);
                          axios.post('http://localhost:5000/user/v1/github', formData).then( response => {
                              console.log(response)
                          }).catch(error => {
                              console.log('ðŸ¤•' + error.message)
                          })*/
                      }).catch( function(error) {
                          // Handle error
                          console.log(error.message)
                      });
                  })
          },

          signInWithTwitter() {
              const provider = new firebase.auth.TwitterAuthProvider()
              provider.addScope('profile');
              provider.addScope('email');
              firebase.auth().signInWithPopup(provider)
                  .catch(error => alert('ðŸ¤•' + error.message))
                  .then(function(data) {
                      firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
                          // Send token to your backend via HTTPS
                          // ...
                          /*const formData = new FormData();
                          formData.append('access_token', idToken);
                          axios.post('http://localhost:5000/user/v1/twitter', formData).then( response => {
                              console.log(response)
                          }).catch(error => {
                              alert('ðŸ¤•' + error.message)
                          })*/
                      }).catch( function(error) {
                          // Handle error
                          alert(error.message)
                      })
                  })
          }
      },
      created() {
          firebase.auth().onAuthStateChanged(function (user) {
              console.log(user)
              this.authUser = user
          })
      },
  })
</script>

</body>
</html>
